<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="initial-scale=1.0" />
        <title>Facebook friends all around the world</title>
        <style>
          html, body, #map-canvas {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        .gm-style-iw{ /* infowindow */
            /*width: 200px;*/
        }
        .gm-style-iw img {
            max-width: 100px;
            height: auto;
        }
        </style>
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
        <script>
          $(document).ready(function () {
            var defaultLatLng = new google.maps.LatLng(47, -2); // Default
            if (navigator.geolocation) {
                function success(pos) {
                    // Location found, show map with these coordinates
                    drawMap(new google.maps.LatLng(pos.coords.latitude, pos.coords.longitude));
                }
                function fail(error) {
                    drawMap(defaultLatLng); // Failed to find location, show default map
                }
                // Find the users current position.  Cache the location for 5 minutes, timeout after 6 seconds
                navigator.geolocation.getCurrentPosition(success, fail, {
                    maximumAge: 500000,
                    enableHighAccuracy: true,
                    timeout: 6000
                });
            } else {
                drawMap(defaultLatLng); // No geolocation support, show default map
            }
            function drawMap(latlng) {
                var myOptions = {
                    zoom: 2,
                    center: latlng,
                    mapTypeId: google.maps.MapTypeId.ROADMAP
                };
                var map = new google.maps.Map(document.getElementById("map-canvas"), myOptions);
                // place the infowindow.  Invisible, without content.
                
                //READ FROM JSON
                $.getJSON('poi.json', function (user) {
                    for (i = 0;i < user.length; i++) {
                        var fbid = user[i].fbid;
                        var username = user[i].username;
                        var locations = user[i].locations;
                        for (ii = 0;ii < locations.length; ii++) {
                            var marker = new google.maps.Marker({
                                position: new google.maps.LatLng(locations[ii].x, locations[ii].y),
                                map: map,
                                title: username
                            });
                            marker.infowindow = new google.maps.InfoWindow({
                                content: username+"<br /><img src=\"https://graph.facebook.com/"+fbid+"/picture\" />"
                            });
                            // when the client clicks on a marker we set the content and bind the position to the marker
                            google.maps.event.addListener(marker, 'click', function() {
                              this.infowindow.open(map,this);
                          });
                        }
                    }
                });
        }
        });
        </script>
    </head>
    <body>
        <div id="map-canvas"></div>
    </body>
</html>